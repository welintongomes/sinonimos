<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Jogo de SinÃ´nimos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { padding: 20px; }
    #options button { margin: 5px; }
    #timer { font-weight: bold; }
    #game-area { display: none; }
  </style>
</head>
<body>

<div class="container">
  <h1 class="mb-4">ðŸ§  Jogo de SinÃ´nimos</h1>

  <div class="mb-3">
    <label for="difficulty">Dificuldade:</label>
    <select id="difficulty" class="form-select w-25 mb-3">
      <option value="15">FÃ¡cil (15s)</option>
      <option value="10">MÃ©dio (10s)</option>
      <option value="5">DifÃ­cil (5s)</option>
    </select>
    <button class="btn btn-primary" onclick="startGame()">ðŸŽ® Iniciar Jogo</button>
  </div>

  <div id="game-area">
    <div id="word" class="h4 mb-3"></div>
    <div id="options" class="mb-3"></div>
    <div id="result" class="mb-2"></div>
    <div id="timer"></div>
    <div id="score" class="mt-2"></div>
    <button class="btn btn-secondary mt-2" onclick="nextWord()">PrÃ³xima</button>
  </div>

  <hr>

  <h3>Painel do Administrador</h3>
  <div class="mb-3">
    <input type="text" class="form-control mb-2" id="admin-word" placeholder="Palavra">
    <input type="text" class="form-control mb-2" id="admin-correct" placeholder="SinÃ´nimo correto">
    <input type="text" class="form-control mb-2" id="admin-options" placeholder="3 opÃ§Ãµes separadas por vÃ­rgula">
    <button class="btn btn-success" onclick="addWord()">Adicionar Palavra</button>
  </div>

  <h4>Importar / Exportar</h4>
  <div class="mb-3">
    <input type="file" class="form-control mb-2" onchange="importFromJson(event)">
    <button class="btn btn-info" onclick="exportToJson()">Exportar JSON</button>
  </div>
  <h5 class="mt-4">Palavras Cadastradas</h5>
<ul id="word-list" class="list-group mb-3"></ul>

</div>

<script>
  let allWords = [];
  let questions = [];
  let score = 0;
  let timer;
  let timeLeft;
  let currentIndex = 0;
  let delayTimeout;
  let db;
  let difficulty = 10;

  const request = indexedDB.open("SinonimosDB", 1);
  request.onupgradeneeded = function (event) {
    db = event.target.result;
    if (!db.objectStoreNames.contains("palavras")) {
      db.createObjectStore("palavras", { keyPath: "word" });
    }
  };

  request.onsuccess = function (event) {
    db = event.target.result;
    loadWordsFromDB();
  };

  function loadWordsFromDB() {
    const tx = db.transaction("palavras", "readonly");
    const store = tx.objectStore("palavras");
    const getAll = store.getAll();
    getAll.onsuccess = () => {
      allWords = getAll.result;
      if (allWords.length === 0) {
        const defaults = [
          { word: "feliz", correct: "contente", options: ["contente", "triste", "nervoso"] },
          { word: "bonito", correct: "belo", options: ["feio", "belo", "velho"] },
          { word: "inteligente", correct: "sagaz", options: ["bobo", "sagaz", "lento"] }
        ];
        defaults.forEach(w => saveWordToDB(w));
      }
    };
  }

  function saveWordToDB(wordObj) {
    const tx = db.transaction("palavras", "readwrite");
    const store = tx.objectStore("palavras");
    store.put(wordObj);
  }

  function startGame() {
    difficulty = parseInt(document.getElementById("difficulty").value);
    document.getElementById("game-area").style.display = "block";
    questions = [...allWords];
    shuffleArray(questions);
    score = 0;
    currentIndex = 0;
    document.getElementById("score").textContent = "";
    loadWord();
  }

  function loadWord() {
    clearInterval(timer);
    clearTimeout(delayTimeout);
    timeLeft = difficulty;
    updateTimerDisplay();

    const current = questions[currentIndex];
    if (!current) return endGame();

    document.getElementById("word").textContent = `Qual o sinÃ´nimo de: ${current.word}`;
    document.getElementById("options").innerHTML = "";
    document.getElementById("result").textContent = "";

    shuffleArray(current.options).forEach(option => {
      const btn = document.createElement("button");
      btn.className = "btn btn-outline-primary";
      btn.textContent = option;
      btn.onclick = () => checkAnswer(option);
      document.getElementById("options").appendChild(btn);
    });

    timer = setInterval(() => {
      timeLeft--;
      updateTimerDisplay();
      if (timeLeft === 0) {
        clearInterval(timer);
        checkAnswer(null);
      }
    }, 1000);
  }

  function updateTimerDisplay() {
    document.getElementById("timer").textContent = `â³ Tempo: ${timeLeft}s`;
  }

  function checkAnswer(selected) {
    clearInterval(timer);
    const current = questions[currentIndex];
    const correct = current.correct;
    const resultDiv = document.getElementById("result");

    if (selected === correct) {
      resultDiv.textContent = "âœ… Acertou!";
      resultDiv.style.color = "green";
      score++;
    } else if (selected === null) {
      resultDiv.textContent = `â° Tempo esgotado! Resposta: ${correct}`;
      resultDiv.style.color = "orange";
    } else {
      resultDiv.textContent = `âŒ Errou! Resposta: ${correct}`;
      resultDiv.style.color = "red";
    }

    document.getElementById("score").textContent = `PontuaÃ§Ã£o: ${score}/${questions.length}`;

    delayTimeout = setTimeout(() => nextWord(), 3000);
  }

  function nextWord() {
    clearTimeout(delayTimeout);
    currentIndex++;
    if (currentIndex < questions.length) {
      loadWord();
    } else {
      endGame();
    }
  }

  function endGame() {
    document.getElementById("word").textContent = "ðŸ Fim de jogo!";
    document.getElementById("options").innerHTML = "";
    document.getElementById("result").textContent = `PontuaÃ§Ã£o final: ${score}/${questions.length}`;
    document.getElementById("timer").textContent = "";
  }

  function addWord() {
    const word = document.getElementById("admin-word").value.trim();
    const correct = document.getElementById("admin-correct").value.trim();
    const options = document.getElementById("admin-options").value.split(",").map(o => o.trim());

    if (!word || !correct || options.length !== 3) {
      alert("Preencha todos os campos corretamente!");
      return;
    }

    const newEntry = { word, correct, options };
    saveWordToDB(newEntry);
    allWords.push(newEntry);
    document.getElementById("admin-word").value = "";
    document.getElementById("admin-correct").value = "";
    document.getElementById("admin-options").value = "";
  }

  function exportToJson() {
    const tx = db.transaction("palavras", "readonly");
    const store = tx.objectStore("palavras");
    const req = store.getAll();
    req.onsuccess = () => {
      const blob = new Blob([JSON.stringify(req.result, null, 2)], { type: "application/json" });
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "sinonimos.json";
      a.click();
    };
  }

  function importFromJson(event) {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = () => {
      const data = JSON.parse(reader.result);
      const tx = db.transaction("palavras", "readwrite");
      const store = tx.objectStore("palavras");
      data.forEach(item => store.put(item));
      tx.oncomplete = () => {
        loadWordsFromDB();
        alert("Importado com sucesso!");
      };
    };
    reader.readAsText(file);
  }

  function shuffleArray(array) {
    for (let i = array.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [array[i], array[j]] = [array[j], array[i]];
    }
    return array;
  }
  function refreshWordList() {
  const tx = db.transaction("palavras", "readonly");
  const store = tx.objectStore("palavras");
  const req = store.getAll();
  req.onsuccess = () => {
    const list = document.getElementById("word-list");
    list.innerHTML = "";
    req.result.forEach(item => {
      const li = document.createElement("li");
      li.className = "list-group-item d-flex justify-content-between align-items-start";

      const text = document.createElement("div");
      text.innerHTML = `<strong>${item.word}</strong>: ${item.options.join(", ")} (âœ… ${item.correct})`;
      li.appendChild(text);

      const btnGroup = document.createElement("div");
      btnGroup.className = "btn-group";

      const editBtn = document.createElement("button");
      editBtn.className = "btn btn-sm btn-warning";
      editBtn.textContent = "Editar";
      editBtn.onclick = () => editWord(item);

      const deleteBtn = document.createElement("button");
      deleteBtn.className = "btn btn-sm btn-danger";
      deleteBtn.textContent = "Excluir";
      deleteBtn.onclick = () => deleteWord(item.word);

      btnGroup.appendChild(editBtn);
      btnGroup.appendChild(deleteBtn);
      li.appendChild(btnGroup);

      list.appendChild(li);
    });
  };
}

function editWord(item) {
  document.getElementById("admin-word").value = item.word;
  document.getElementById("admin-correct").value = item.correct;
  document.getElementById("admin-options").value = item.options.join(", ");
}

function deleteWord(word) {
  const tx = db.transaction("palavras", "readwrite");
  const store = tx.objectStore("palavras");
  store.delete(word);
  tx.oncomplete = () => {
    loadWordsFromDB();
    alert(`Palavra "${word}" removida.`);
  };
}

// Atualiza a funÃ§Ã£o saveWordToDB para tambÃ©m atualizar a lista apÃ³s salvar
function saveWordToDB(wordObj) {
  const tx = db.transaction("palavras", "readwrite");
  const store = tx.objectStore("palavras");
  store.put(wordObj);
  tx.oncomplete = () => refreshWordList(); // Atualiza lista ao salvar
}

// Atualiza a funÃ§Ã£o loadWordsFromDB para exibir a lista apÃ³s carregar
function loadWordsFromDB() {
  const tx = db.transaction("palavras", "readonly");
  const store = tx.objectStore("palavras");
  const getAll = store.getAll();
  getAll.onsuccess = () => {
    allWords = getAll.result;
    if (allWords.length === 0) {
      const defaults = [
        { word: "feliz", correct: "contente", options: ["contente", "triste", "nervoso"] },
        { word: "bonito", correct: "belo", options: ["feio", "belo", "velho"] },
        { word: "inteligente", correct: "sagaz", options: ["bobo", "sagaz", "lento"] }
      ];
      defaults.forEach(w => saveWordToDB(w));
    } else {
      refreshWordList();
    }
  };
}

</script>

</body>
</html>
